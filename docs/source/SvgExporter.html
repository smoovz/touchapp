<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js"><span id='global-property-'>/**
</span> * Exports an SVG document to an image. To do this,
 * the SVG string must be sent to a remote server and processed.
 *
 * # Sending the data
 *
 * A post request is made to the URL. The following fields are sent:
 *
 * + width: The width of the image
 * + height: The height of the image
 * + type: The image type to save as, see {@link #supportedTypes}
 * + svg: The svg string for the surface
 *
 * # The response
 *
 * It is expected that the user will be prompted with an image download.
 * As such, the following options should be set on the server:
 *
 * + Content-Disposition: &#39;attachment, filename=&quot;chart.png&quot;&#39;
 * + Content-Type: &#39;image/png&#39;
 *
 * **Important**: By default, chart data is sent to a server operated
 * by Sencha to do data processing. You may change this default by
 * setting the {@link #defaultUrl} of this class.
 * In addition, please note that this service only creates PNG images.
 */
// TODO: can&#39;t use the canvas element to convert SVG to bitmap on the client, see:
// TODO: http://stackoverflow.com/questions/18586808/canvas-todatauri-on-chrome-security-issue
Ext.define(&#39;Ext.draw.engine.SvgExporter&#39;, {
    singleton: true,

<span id='global-property-defaultUrl'>    /**
</span>     * @property {String} [defaultUrl=&quot;http://svg.sencha.io&quot;]
     * The default URL to submit the form request.
     */
    defaultUrl: &#39;http://svg.sencha.io&#39;,

<span id='global-property-supportedTypes'>    /**
</span>     * @property {Array} [supportedTypes=[&quot;image/png&quot;, &quot;image/jpeg&quot;]]
     * A list of export types supported by the server
     */
    supportedTypes: [&#39;image/png&#39;, &#39;image/jpeg&#39;],

<span id='global-property-widthParam'>    /**
</span>     * @property {String} [widthParam=&quot;width&quot;]
     * The name of the width parameter to be sent to the server.
     * The Sencha IO server expects it to be the default value.
     */
    widthParam: &#39;width&#39;,

<span id='global-property-heightParam'>    /**
</span>     * @property {String} [heightParam=&quot;height&quot;]
     * The name of the height parameter to be sent to the server.
     * The Sencha IO server expects it to be the default value.
     */
    heightParam: &#39;height&#39;,

<span id='global-property-typeParam'>    /**
</span>     * @property {String} [typeParam=&quot;type&quot;]
     * The name of the type parameter to be sent to the server.
     * The Sencha IO server expects it to be the default value.
     */
    typeParam: &#39;type&#39;,

<span id='global-property-svgParam'>    /**
</span>     * @property {String} [svgParam=&quot;svg&quot;]
     * The name of the svg parameter to be sent to the server.
     * The Sencha IO server expects it to be the default value.
     */
    svgParam: &#39;svg&#39;,

    formCls: Ext.baseCSSPrefix + &#39;hide-display&#39;,

<span id='global-method-generate'>    /**
</span>     * Exports the surface to an image
     * @param {String} svg The SVG document.
     * @param {Object} [config] The following config options are supported:
     *
     * @param {Number} config.width A width to send to the server to for
     * configuring the image width (required)
     *
     * @param {Number} config.height A height to send to the server for
     * configuring the image height (required)
     *
     * @param {String} config.url The url to post the data to. Defaults to
     * the {@link #defaultUrl} configuration on the class.
     *
     * @param {String} config.type The type of image to export. See the
     * {@link #supportedTypes}
     *
     * @param {String} config.widthParam The name of the width parameter to send
     * to the server. Defaults to {@link #widthParam}
     *
     * @param {String} config.heightParam The name of the height parameter to send
     * to the server. Defaults to {@link #heightParam}
     *
     * @param {String} config.typeParam The name of the type parameter to send
     * to the server. Defaults to {@link #typeParam}
     *
     * @param {String} config.svgParam The name of the svg parameter to send
     * to the server. Defaults to {@link #svgParam}
     *
     * @return {Boolean} True if the surface was successfully sent to the server.
     */
    generate: function(svg, config) {
        config = config || {};
        var me = this,
            type = config.type,
            form;

        if (Ext.Array.indexOf(me.supportedTypes, type) === -1) {
            return false;
        }

        form = Ext.getBody().createChild({
            tag: &#39;form&#39;,
            method: &#39;POST&#39;,
            action: config.url || me.defaultUrl,
            cls: me.formCls,
            children: [{
                tag: &#39;input&#39;,
                type: &#39;hidden&#39;,
                name: config.widthParam || me.widthParam,
                value: config.width
            }, {
                tag: &#39;input&#39;,
                type: &#39;hidden&#39;,
                name: config.heightParam || me.heightParam,
                value: config.height
            }, {
                tag: &#39;input&#39;,
                type: &#39;hidden&#39;,
                name: config.typeParam || me.typeParam,
                value: type
            }, {
                tag: &#39;input&#39;,
                type: &#39;hidden&#39;,
                name: config.svgParam || me.svgParam
            }]
        });

        // Assign the data on the value so it doesn&#39;t get messed up in the html insertion
        form.last(null, true).value = svg;

        form.dom.submit();
        form.remove();
        return true;
    }

});
</pre>
</body>
</html>
